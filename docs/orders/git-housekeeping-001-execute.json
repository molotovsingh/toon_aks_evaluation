{
  "order_id": "git-housekeeping-001-execute",
  "priority": "medium",
  "version": "v1.0",
  "supercontext": {
    "repository": "docling_langextract_testing",
    "mission": "Execute full housekeeping on clean repository baseline: harden .gitignore rules, prune stale branches (if any), clean artifacts, and establish evergreen housekeeping checklist for future maintenance cycles.",
    "current_state": [
      "Repository is clean after manual commit of feature work following triage phase (Logfire ADR, V1/V2 testing scripts, cache documentation, email parser feature).",
      "Only 'main' branch exists locally - no stale branches to prune (verified in triage).",
      "Current .gitignore has identified gaps: streamlit_outputs/ directory not explicitly listed, need to verify *.log coverage.",
      "Intentional tracking: config/benchmarks/ artifacts are tracked via exception rules (.gitignore lines 64-66) - MUST PRESERVE THESE RULES.",
      "sample_pdf/ test fixtures are tracked via exception rules (.gitignore lines 60-62) - MUST PRESERVE THESE RULES.",
      "test_results/ directory is correctly ignored (.gitignore line 91) - no changes needed.",
      "Ready for housekeeping: baseline is clean, changes will be isolated and reversible."
    ]
  },
  "goal": "Complete git housekeeping workflow by hardening ignore rules, pruning orphaned remote refs, documenting the process, and creating an evergreen checklist for monthly maintenance cadence.",
  "execution_instructions": [
    "Review CLAUDE.md for design mantras (keep it boring, leave breadcrumbs) before making changes.",
    "Capture every command with output in docs/reports/git-housekeeping-001-execution-{timestamp}.md",
    "Work on main branch - DO NOT create feature branch (housekeeping is infrastructure work)",
    "Use dry-run commands (git clean -fdn, --dry-run flags) before any destructive operations",
    "CRITICAL: Do NOT modify .gitignore lines 60-66 (intentional exception rules for fixtures and benchmarks)",
    "Escalate if unexpected files appear during execution or tests fail post-housekeeping"
  ],
  "tasks": [
    {
      "id": "gitignore-hardening",
      "description": "Close .gitignore gaps while strictly preserving intentional tracking decisions",
      "steps": [
        "Read current .gitignore file and identify lines 60-66 (exception rules section)",
        "Add inline comment above line 54 (Output files section): '# Streamlit export directory (regeneratable artifacts)'",
        "Add pattern 'streamlit_outputs/' on new line after line 54",
        "Verify *.log is present in .gitignore - if missing, add '*.log' after line 76 with comment '# Application logs'",
        "CRITICAL VERIFICATION: Confirm lines 60-66 remain unchanged (sample_pdf and config/benchmarks exception rules)",
        "Run `git status --ignored` and capture output - verify streamlit_outputs/ now appears in ignored section",
        "Run `git diff .gitignore` and document exact changes in execution report",
        "Document rationale: streamlit_outputs/ contains CSV/XLSX exports from UI that are regeneratable, not source material"
      ]
    },
    {
      "id": "branch-hygiene",
      "description": "Prune stale branches with conditional execution if any exist",
      "steps": [
        "Run `git branch --list | wc -l` and store result as $BRANCH_COUNT",
        "If $BRANCH_COUNT == 1: Document 'Only main branch exists - local branch cleanup skipped' in execution report and proceed to remote prune",
        "If $BRANCH_COUNT > 1: Run `git branch --sort=-committerdate` and document output, then for each non-main branch: check if merged with `git branch --merged main`, delete merged branches with `git branch -d <branch>`, document any branches that fail deletion (unmerged) in 'Needs Maintainer Review' section",
        "Run `git remote prune origin` to clean orphaned remote-tracking refs and capture output",
        "Document branch cleanup status in execution report: 'Local branches: {count before} â†’ {count after}, Remote refs pruned: {count}'",
        "If any branches require remote deletion: Add git push commands to 'Pending Actions for Maintainer' section"
      ]
    },
    {
      "id": "artifact-cleanup",
      "description": "Remove untracked artifacts not covered by .gitignore updates",
      "steps": [
        "Run `git clean -fdn` (dry-run) to preview what would be deleted and capture output",
        "Review dry-run output: if it includes source files (.py, .json configs, .md docs), ABORT and document in report",
        "If dry-run looks safe (only exports, logs, cache files): Run `git clean -fd` and capture output showing deleted files",
        "EXCEPTION: If git clean would delete test_documents/ directory, skip this step and escalate for manual review (unclear if fixtures or outputs)",
        "Document in execution report: 'Artifacts cleaned: {count} files deleted' with full list of deleted paths",
        "If this step was skipped due to concerns: Add 'Requires Manual Review' section explaining why and what files need clarification"
      ]
    },
    {
      "id": "housekeeping-checklist",
      "description": "Create evergreen housekeeping checklist and update project documentation",
      "steps": [
        "Create/update docs/reports/git-housekeeping-001-execution-{timestamp}.md with sections: Initial State, .gitignore Changes, Branch Operations, Artifact Cleanup, Test Results, Next Review Date (30 days from now)",
        "Add section to AGENTS.md under 'Development Workflow' heading: '## Git Housekeeping\\n\\nRun monthly maintenance via two-phase workflow:\\n1. Triage: `git-housekeeping-001-triage.json` (analyze state)\\n2. Commit: Manual commit of feature work\\n3. Execute: `git-housekeeping-001-execute.json` (cleanup)\\n\\nSee docs/orders/ for order files and docs/reports/ for execution history.'",
        "Update docs/orders/README.md to list both housekeeping orders in 'Infrastructure Orders' section with status and links",
        "Add .gitignore changes note to README.md in 'Development Setup' section: 'Note: streamlit_outputs/ and *.log are ignored as transient artifacts. Benchmarks in config/benchmarks/ are intentionally tracked.'",
        "Document next review date (30 days) in execution report and AGENTS.md"
      ]
    },
    {
      "id": "post-cleanup-validation",
      "description": "Verify repository integrity and cleanliness after housekeeping",
      "steps": [
        "Run `git status -sb` and verify output shows only intentional changes (.gitignore updates, AGENTS.md update, execution report)",
        "Run `uv run python tests/run_all_tests.py --quick` to verify pipeline still passes - capture summary output",
        "If tests fail: Document failure details in 'Test Failures' section of execution report and ABORT commit",
        "If tests pass: Document 'Test Validation: PASSED' with execution time",
        "Run `git status --ignored` and verify streamlit_outputs/, *.log files appear in ignored section",
        "Create 'Post-Housekeeping Summary' section in report: files modified (should be 3-4), tests status, git status output",
        "List any pending actions for maintainer: remote branch deletions, unclear files from artifact cleanup, etc.",
        "Document housekeeping completion timestamp and recommend commit message"
      ]
    }
  ],
  "acceptance_criteria": [
    ".gitignore modified to add streamlit_outputs/ and verify *.log coverage, with lines 60-66 (exception rules) PRESERVED EXACTLY",
    "Branch hygiene executed conditionally - if only main exists, task documented as skipped; remote prune always executed",
    "Artifact cleanup completed with dry-run verification - no source files deleted, only transient artifacts",
    "docs/reports/git-housekeeping-001-execution-{timestamp}.md contains complete record: initial state, all changes, command outputs, test results",
    "AGENTS.md updated with housekeeping cadence (monthly) and workflow description",
    "docs/orders/README.md lists both housekeeping orders (triage and execute) in infrastructure section",
    "`uv run python tests/run_all_tests.py --quick` passes successfully post-housekeeping",
    "git status shows only intentional changes (documentation updates, .gitignore hardening)"
  ],
  "constraints": {
    "what_not_to_do": [
      "NEVER modify .gitignore lines 60-66 (sample_pdf and config/benchmarks exception rules are intentional)",
      "NEVER run git clean -fd without first running git clean -fdn and verifying output contains only artifacts",
      "NEVER force-delete branches with git branch -D unless maintainer explicitly approves",
      "NEVER add broad ignore patterns (*.py, *.json, *.md) that could hide source files",
      "NEVER delete directories without confirming they are outputs vs. fixtures (e.g., test_documents/)",
      "NEVER commit changes if test suite fails post-housekeeping - investigate failures first",
      "NEVER remove or relax existing .gitignore entries - only ADD new patterns",
      "NEVER modify remote branches or force-push - only local cleanup and remote ref pruning"
    ],
    "escalation_guidance": "If test suite fails, unexpected source files appear in git clean dry-run, or branch ownership is unclear, pause execution and document in 'Escalation Required' section of report. Do not proceed with commit until maintainer reviews."
  },
  "post_execution": {
    "commit_message_template": "chore: Git housekeeping - harden .gitignore, prune refs, establish checklist\n\n- .gitignore: Add streamlit_outputs/ and *.log patterns\n- Branch hygiene: {branch_status} (e.g., 'Only main - no pruning needed' or 'Pruned 3 merged branches')\n- Remote refs: Pruned orphaned tracking branches\n- Documentation: Added monthly housekeeping cadence to AGENTS.md\n- Artifacts: Cleaned {count} transient files\n\nTest validation: PASSED (tests/run_all_tests.py --quick)\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>",
    "next_review_date": "30 days from execution",
    "related_orders": [
      "git-housekeeping-001-triage.json (prerequisite - run first)"
    ]
  },
  "notes": [
    "This is Phase 2 of a two-phase housekeeping workflow",
    "Must run git-housekeeping-001-triage.json first and commit feature work before executing this order",
    "Execution assumes clean baseline - if repo has uncommitted changes, results will be mixed",
    "Monthly cadence recommended: run triage on 1st of month, execute after review",
    "Exception rules in .gitignore are design decisions, not oversights - preserve them"
  ]
}
