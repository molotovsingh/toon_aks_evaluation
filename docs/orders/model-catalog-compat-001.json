{
  "order_id": "model-catalog-compat-001",
  "priority": "high",
  "version": "v1.0",
  "supercontext": {
    "repository": "docling_langextract_testing",
    "mission": "Restore compatibility between the new centralized model catalog and the Streamlit UI selectors."
  },
  "goal": "Ensure `get_ui_model_config_list()` returns objects exposing `format_inline()` (and other legacy attributes) so app.py no longer crashes on `model.format_inline()`.",
  "execution_instructions": [
    "Work inside a feature branch; do not commit directly to main.",
    "Avoid changing the public dataclass `ModelEntry`; provide compatibility with minimal duplication.",
    "Add targeted tests replicating the UI usage to prevent regression."
  ],
  "tasks": [
    {
      "id": "replicate-bug",
      "description": "Confirm the crash scenario.",
      "steps": [
        "Run `uv run streamlit run app.py` (or a quick unit snippet) to reproduce the AttributeError.",
        "Document the exact stack trace and call path (create_unified_model_selector → format_inline)."
      ]
    },
    {
      "id": "implement-shim",
      "description": "Update the UI catalog helper to expose legacy methods.",
      "steps": [
        "Modify `get_ui_model_config_list()` (or add a small adapter class) so returned objects implement `format_inline()` and provide the fields the UI expects.",
        "Keep the logic centralized so future app.py refactors can remove the shim easily.",
        "Ensure badges, quality score, cost, and context strings appear in the same order as before." 
      ]
    },
    {
      "id": "add-tests",
      "description": "Create regression coverage for the compatibility layer.",
      "steps": [
        "Add a unit test (`tests/test_model_catalog_ui.py`) that calls `get_ui_model_config_list()` and asserts objects have `format_inline`, `display_name`, etc.",
        "Optionally snapshot a few formatted strings so future catalog changes trigger test failures." 
      ]
    },
    {
      "id": "verify-ui",
      "description": "Smoke test the Streamlit selector.",
      "steps": [
        "Launch `uv run streamlit run app.py` and confirm dropdowns render without exceptions.",
        "Check the inline display text (quality • cost • context • badges) matches previous behavior." 
      ]
    }
  ],
  "acceptance_criteria": [
    "`get_ui_model_config_list()` returns objects that support `format_inline()` and the app no longer raises AttributeError.",
    "New regression test passes locally and in CI.",
    "Manual Streamlit check shows model selectors working as before.",
    "Compatibility shim documented for eventual removal (once app.py is refactored to use the new ModelEntry directly)."
  ],
  "constraints": {
    "what_not_to_do": [
      "Do not revert to the old hard-coded MODEL_CATALOG in app.py.",
      "Avoid copy-pasting large sections from the old code; provide a minimal adapter.",
      "Do not introduce breaking changes to `ModelEntry`."
    ],
    "escalation_guidance": "If the UI requires additional fields beyond `format_inline()`, capture them in the shim and document the need for a fuller refactor."
  },
  "testing": {
    "required_commands": [
      "uv run python -m unittest tests/test_model_catalog_ui.py",
      "uv run streamlit run app.py"
    ],
    "notes": "Manual UI check can be brief—just ensure the model selector loads without errors." 
  }
}
