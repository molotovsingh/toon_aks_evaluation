{
  "order_id": "git-housekeeping-001-triage",
  "priority": "medium",
  "version": "v1.0",
  "supercontext": {
    "repository": "docling_langextract_testing",
    "mission": "Perform read-only triage of repository state to categorize untracked files, identify .gitignore gaps, and provide actionable guidance for manual commits before full housekeeping execution.",
    "current_state": [
      "Repository is ahead of origin/main by 1 commit with 20+ modified files from recent work (LangExtract V1/V2 testing, Logfire ADR documentation, UI improvements, cache testing).",
      "50+ untracked files exist including new scripts (test_langextract_v1_v2.py, compare_prompt_versions.py), documentation (ADR-002, CACHE_TESTING_GUIDE.md), test outputs, and archived orders.",
      "Only 'main' branch exists locally - no stale branches present.",
      "Current .gitignore has gaps: streamlit_outputs/ directory not explicitly listed, *.log files may not be covered.",
      "Intentional tracking: config/benchmarks/ artifacts are tracked via exception rules (lines 64-66 in .gitignore) - these are valuable benchmarking results, not noise."
    ]
  },
  "goal": "Generate a comprehensive triage report categorizing all untracked files into COMMIT/IGNORE/INVESTIGATE/PRESERVE buckets with actionable guidance, enabling the maintainer to make informed decisions about what to commit before running full housekeeping.",
  "execution_instructions": [
    "This is a READ-ONLY order - make NO changes to repository state (no git add, no git clean, no commits, no deletions).",
    "All analysis output goes to docs/reports/git-housekeeping-triage-{timestamp}.md with clear sections for each category.",
    "For every file categorization, provide rationale explaining WHY that category was chosen.",
    "Flag potential security issues (secrets, API keys) immediately - do not proceed if found.",
    "Respect existing .gitignore exception rules - do not recommend ignoring intentionally-tracked files."
  ],
  "tasks": [
    {
      "id": "snapshot-capture",
      "description": "Capture complete repository state snapshot for analysis baseline",
      "steps": [
        "Run `git status -sb` and save output to report under 'Git Status Summary' heading",
        "Run `git status --ignored` and save output to report under 'Ignored Files' heading",
        "Run `git ls-files --others --exclude-standard` to list all untracked files and save to report under 'Untracked Files (Raw List)' heading",
        "Run `git branch --sort=-committerdate` and save output to report under 'Local Branches' heading",
        "Run `git branch -r --sort=-committerdate` and save output to report under 'Remote-Tracking Branches' heading",
        "Document timestamp of snapshot at top of report",
        "Count: modified files, untracked files, ignored files, branches - add summary table to report"
      ]
    },
    {
      "id": "file-categorization",
      "description": "Categorize all untracked files into actionable buckets with rationale",
      "steps": [
        "Create 4 sections in report: 'Category A: COMMIT', 'Category B: IGNORE', 'Category C: PRESERVE', 'Category D: INVESTIGATE'",
        "For Category A (COMMIT), identify files that are feature work, documentation, or test coverage - examples: docs/adr/ADR-002-observability-with-logfire.md (new ADR), scripts/test_langextract_v1_v2.py (V1/V2 comparison tool), docs/CACHE_TESTING_GUIDE.md (documentation), src/core/email_parser.py (new feature)",
        "For Category B (IGNORE), identify transient artifacts, logs, generated configs, test outputs - examples: streamlit.log (application logs), test_results/langextract_comparison/* (test outputs already ignored by line 91), streamlit_outputs/* (export artifacts)",
        "For Category C (PRESERVE), identify files already tracked by exception rules - check config/benchmarks/results/*.json and *.csv against .gitignore lines 64-66",
        "For Category D (INVESTIGATE), identify files with unclear purpose - examples: scripts/test_email_parser.py (temp or keeper?), config/adicr_targets.json (generated or static?), test_documents/ (fixtures or outputs?)",
        "For EACH file, add one-line rationale explaining the categorization decision",
        "Flag any files in directories that don't exist yet (may need mkdir before commit)"
      ]
    },
    {
      "id": "security-scan",
      "description": "Scan for potential secrets or sensitive data in untracked files",
      "steps": [
        "Run `git ls-files --others --exclude-standard | xargs grep -l -i 'api_key\\|secret\\|token\\|password' 2>/dev/null || true` to find potential secrets",
        "Check if .env file is properly ignored (should appear in git status --ignored, NOT in git status)",
        "Review any flagged files manually - look for actual credentials vs. variable names in code",
        "If real secrets found: Add 'SECURITY ALERT' section to report with file paths and ABORT further housekeeping",
        "If no secrets found: Add 'Security Scan: PASSED' section to report with confirmation message",
        "Document scan methodology in report so maintainer understands what was checked"
      ]
    },
    {
      "id": "gitignore-gap-analysis",
      "description": "Identify patterns missing from .gitignore that should be added",
      "steps": [
        "Read current .gitignore file and document existing patterns in report under '.gitignore Current State' heading",
        "CRITICAL: Document lines 60-66 as INTENTIONAL EXCEPTION RULES that must be preserved (sample_pdf/ tracking, benchmarks/ tracking)",
        "Identify gaps based on Category B (IGNORE) files: Does streamlit_outputs/ need explicit directory ignore? Are *.log files covered?",
        "For each gap, propose specific .gitignore pattern with line number where it should be added",
        "Test proposed patterns mentally: Would they mask any Category A (COMMIT) files? If yes, mark as 'REQUIRES REVIEW'",
        "Create '.gitignore Proposed Additions' section in report with rationale for each pattern",
        "Add warning: 'Do NOT modify lines 60-66 (exception rules are intentional)' in proposal section"
      ]
    },
    {
      "id": "decision-matrix",
      "description": "Generate actionable commands and recommendations for maintainer",
      "steps": [
        "Create 'Recommended Actions' section in report with 3 subsections: 'Step 1: Commit Feature Work', 'Step 2: Update .gitignore', 'Step 3: Run Execute Phase'",
        "For Step 1: Generate sample `git add` commands for all Category A (COMMIT) files, one per line",
        "For Step 1: Draft a commit message following project conventions (feat/fix/docs prefix, explain what/why, include Claude Code footer)",
        "For Step 2: List exact .gitignore additions with line numbers (e.g., 'Add streamlit_outputs/ after line 54')",
        "For Step 3: Reference git-housekeeping-001-execute.json as next order to run after Steps 1-2 complete",
        "Create 'Files Needing Maintainer Review' subsection for Category D (INVESTIGATE) items with questions to answer",
        "Add 'Summary Statistics' table: files to commit (count), patterns to ignore (count), files needing review (count)",
        "Include 'Next Steps' checklist at end of report: [ ] Review categorization, [ ] Execute Step 1 (commit), [ ] Execute Step 2 (.gitignore), [ ] Run execute order"
      ]
    }
  ],
  "acceptance_criteria": [
    "docs/reports/git-housekeeping-triage-{timestamp}.md exists with all required sections: snapshot, categorization (4 categories), security scan, .gitignore analysis, decision matrix",
    "Every untracked file from snapshot appears in exactly one category (A/B/C/D) with rationale",
    "Security scan completed and documented (PASSED or SECURITY ALERT)",
    ".gitignore gap analysis includes preservation warning for lines 60-66",
    "Decision matrix includes sample git add commands for Category A files and draft commit message",
    "Report includes 'Next Steps' checklist linking to execute phase order",
    "NO repository changes made (git status before/after order execution is identical)"
  ],
  "constraints": {
    "what_not_to_do": [
      "Do NOT run git add, git commit, git clean, or any command that modifies repository state",
      "Do NOT delete, move, or rename any files",
      "Do NOT modify .gitignore or any tracked files",
      "Do NOT recommend ignoring files that match exception rules in .gitignore lines 60-66 (these are intentional)",
      "Do NOT recommend broad ignore patterns (*.py, *.json, *.md) that could mask source files",
      "Do NOT proceed past security scan task if real secrets/credentials are found - escalate immediately"
    ],
    "escalation_guidance": "If security scan finds real credentials/secrets in untracked files, ABORT order execution and alert maintainer with file paths. Do not continue to decision matrix task."
  },
  "notes": [
    "This is Phase 1 of a two-phase housekeeping workflow",
    "Phase 2 (git-housekeeping-001-execute.json) runs AFTER maintainer commits feature work based on this triage report",
    "Triage can run safely on dirty repository - execute phase requires clean baseline",
    "Report output format should be markdown with clear headings for easy navigation"
  ]
}
